!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("@angular/core"),require("rxjs/operators"),require("@angular/common")):"function"==typeof define&&define.amd?define("angular-draggable-droppable",["exports","rxjs","@angular/core","rxjs/operators","@angular/common"],t):t(e["angular-draggable-droppable"]={},e.rxjs,e.ng.core,e.rxjs.operators,e.ng.common)}(this,function(e,p,a,d,t){"use strict";var m=function(){return(m=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function g(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(i)throw i.error}}return s}var n=function(){function e(){this.currentDrag=new p.Subject}return e.decorators=[{type:a.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=a.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),r=function(){function e(e){this.elementRef=e}return e.decorators=[{type:a.Directive,args:[{selector:"[mwlDraggableScrollContainer]"}]}],e.ctorParameters=function(){return[{type:a.ElementRef}]},e}(),i=function(){function e(e,t,n,r,i,o,s){this.element=e,this.renderer=t,this.draggableHelper=n,this.zone=r,this.vcr=i,this.scrollContainer=o,this.document=s,this.dragAxis={x:!0,y:!0},this.dragSnapGrid={},this.ghostDragEnabled=!0,this.showOriginalElementWhileDragging=!1,this.dragCursor="",this.dragPointerDown=new a.EventEmitter,this.dragStart=new a.EventEmitter,this.ghostElementCreated=new a.EventEmitter,this.dragging=new a.EventEmitter,this.dragEnd=new a.EventEmitter,this.pointerDown$=new p.Subject,this.pointerMove$=new p.Subject,this.pointerUp$=new p.Subject,this.eventListenerSubscriptions={},this.destroy$=new p.Subject}return e.prototype.ngOnInit=function(){var u=this;this.checkEventListeners();var e=this.pointerDown$.pipe(d.filter(function(){return u.canDrag()}),d.mergeMap(function(i){i.event.stopPropagation&&i.event.stopPropagation();var e=u.renderer.createElement("style");u.renderer.setAttribute(e,"type","text/css"),u.renderer.appendChild(e,u.renderer.createText("\n          body * {\n           -moz-user-select: none;\n           -ms-user-select: none;\n           -webkit-user-select: none;\n           user-select: none;\n          }\n        ")),u.document.head.appendChild(e);var r=u.getScrollPosition(),t=new p.Observable(function(t){var e=u.scrollContainer?u.scrollContainer.elementRef.nativeElement:"window";return u.renderer.listen(e,"scroll",function(e){return t.next(e)})}).pipe(d.startWith(r),d.map(function(){return u.getScrollPosition()})),o=new p.Subject,s=new p.ReplaySubject;u.zone.run(function(){u.dragPointerDown.next({x:0,y:0})});var n=p.merge(u.pointerUp$,u.pointerDown$,s,u.destroy$).pipe(d.share()),a=p.combineLatest(u.pointerMove$,t).pipe(d.map(function(e){var t=g(e,2),n=t[0],r=t[1];return{currentDrag$:o,transformX:n.clientX-i.clientX,transformY:n.clientY-i.clientY,clientX:n.clientX,clientY:n.clientY,scrollLeft:r.left,scrollTop:r.top}}),d.map(function(e){return u.dragSnapGrid.x&&(e.transformX=Math.round(e.transformX/u.dragSnapGrid.x)*u.dragSnapGrid.x),u.dragSnapGrid.y&&(e.transformY=Math.round(e.transformY/u.dragSnapGrid.y)*u.dragSnapGrid.y),e}),d.map(function(e){return u.dragAxis.x||(e.transformX=0),u.dragAxis.y||(e.transformY=0),e}),d.map(function(e){var t=e.scrollLeft-r.left,n=e.scrollTop-r.top;return m({},e,{x:e.transformX+t,y:e.transformY+n})}),d.filter(function(e){var t=e.x,n=e.y;return!u.validateDrag||u.validateDrag({x:t,y:n})}),d.takeUntil(n),d.share()),c=a.pipe(d.take(1),d.share()),l=a.pipe(d.takeLast(1),d.share());return c.subscribe(function(){if(u.zone.run(function(){u.dragStart.next({cancelDrag$:s})}),u.renderer.addClass(u.element.nativeElement,u.dragActiveClass),u.ghostDragEnabled){var e=u.element.nativeElement.getBoundingClientRect(),t=u.element.nativeElement.cloneNode(!0);if(u.showOriginalElementWhileDragging||u.renderer.setStyle(u.element.nativeElement,"visibility","hidden"),u.ghostElementAppendTo?u.ghostElementAppendTo.appendChild(t):u.element.nativeElement.parentNode.insertBefore(t,u.element.nativeElement.nextSibling),u.ghostElement=t,u.setElementStyles(t,{position:"fixed",top:e.top+"px",left:e.left+"px",width:e.width+"px",height:e.height+"px",cursor:u.dragCursor,margin:"0"}),u.ghostElementTemplate){var n=u.vcr.createEmbeddedView(u.ghostElementTemplate);t.innerHTML="",n.rootNodes.filter(function(e){return e instanceof Node}).forEach(function(e){t.appendChild(e)}),l.subscribe(function(){u.vcr.remove(u.vcr.indexOf(n))})}u.zone.run(function(){u.ghostElementCreated.emit()}),l.subscribe(function(){t.parentElement.removeChild(t),u.ghostElement=null,u.renderer.setStyle(u.element.nativeElement,"visibility","")})}u.draggableHelper.currentDrag.next(o)}),l.pipe(d.mergeMap(function(t){var e=s.pipe(d.count(),d.take(1),d.map(function(e){return m({},t,{dragCancelled:0<e})}));return s.complete(),e})).subscribe(function(e){var t=e.x,n=e.y,r=e.dragCancelled;u.zone.run(function(){u.dragEnd.next({x:t,y:n,dragCancelled:r})}),u.renderer.removeClass(u.element.nativeElement,u.dragActiveClass),o.complete()}),p.merge(n,l).pipe(d.take(1)).subscribe(function(){u.document.head.removeChild(e)}),a}),d.share());p.merge(e.pipe(d.take(1),d.map(function(e){return[,e]})),e.pipe(d.pairwise())).pipe(d.filter(function(e){var t=g(e,2),n=t[0],r=t[1];return!n||(n.x!==r.x||n.y!==r.y)}),d.map(function(e){var t=g(e,2);t[0];return t[1]})).subscribe(function(e){var t=e.x,n=e.y,r=e.currentDrag$,i=e.clientX,o=e.clientY,s=e.transformX,a=e.transformY;if(u.zone.run(function(){u.dragging.next({x:t,y:n})}),u.ghostElement){var c="translate("+s+"px, "+a+"px)";u.setElementStyles(u.ghostElement,{transform:c,"-webkit-transform":c,"-ms-transform":c,"-moz-transform":c,"-o-transform":c})}r.next({clientX:i,clientY:o,dropData:u.dropData})})},e.prototype.ngOnChanges=function(e){e.dragAxis&&this.checkEventListeners()},e.prototype.ngOnDestroy=function(){this.unsubscribeEventListeners(),this.pointerDown$.complete(),this.pointerMove$.complete(),this.pointerUp$.complete(),this.destroy$.next()},e.prototype.checkEventListeners=function(){var t=this,e=this.canDrag(),n=0<Object.keys(this.eventListenerSubscriptions).length;e&&!n?this.zone.runOutsideAngular(function(){t.eventListenerSubscriptions.mousedown=t.renderer.listen(t.element.nativeElement,"mousedown",function(e){t.onMouseDown(e)}),t.eventListenerSubscriptions.mouseup=t.renderer.listen("document","mouseup",function(e){t.onMouseUp(e)}),t.eventListenerSubscriptions.touchstart=t.renderer.listen(t.element.nativeElement,"touchstart",function(e){t.onTouchStart(e)}),t.eventListenerSubscriptions.touchend=t.renderer.listen("document","touchend",function(e){t.onTouchEnd(e)}),t.eventListenerSubscriptions.touchcancel=t.renderer.listen("document","touchcancel",function(e){t.onTouchEnd(e)}),t.eventListenerSubscriptions.mouseenter=t.renderer.listen(t.element.nativeElement,"mouseenter",function(){t.onMouseEnter()}),t.eventListenerSubscriptions.mouseleave=t.renderer.listen(t.element.nativeElement,"mouseleave",function(){t.onMouseLeave()})}):!e&&n&&this.unsubscribeEventListeners()},e.prototype.onMouseDown=function(e){var t=this;this.eventListenerSubscriptions.mousemove||(this.eventListenerSubscriptions.mousemove=this.renderer.listen("document","mousemove",function(e){t.pointerMove$.next({event:e,clientX:e.clientX,clientY:e.clientY})})),this.pointerDown$.next({event:e,clientX:e.clientX,clientY:e.clientY})},e.prototype.onMouseUp=function(e){this.eventListenerSubscriptions.mousemove&&(this.eventListenerSubscriptions.mousemove(),delete this.eventListenerSubscriptions.mousemove),this.pointerUp$.next({event:e,clientX:e.clientX,clientY:e.clientY})},e.prototype.onTouchStart=function(e){var t=this;this.eventListenerSubscriptions.touchmove||(this.eventListenerSubscriptions.touchmove=this.renderer.listen("document","touchmove",function(e){t.pointerMove$.next({event:e,clientX:e.targetTouches[0].clientX,clientY:e.targetTouches[0].clientY})})),this.pointerDown$.next({event:e,clientX:e.touches[0].clientX,clientY:e.touches[0].clientY})},e.prototype.onTouchEnd=function(e){this.eventListenerSubscriptions.touchmove&&(this.eventListenerSubscriptions.touchmove(),delete this.eventListenerSubscriptions.touchmove),this.pointerUp$.next({event:e,clientX:e.changedTouches[0].clientX,clientY:e.changedTouches[0].clientY})},e.prototype.onMouseEnter=function(){this.setCursor(this.dragCursor)},e.prototype.onMouseLeave=function(){this.setCursor("")},e.prototype.canDrag=function(){return this.dragAxis.x||this.dragAxis.y},e.prototype.setCursor=function(e){this.renderer.setStyle(this.element.nativeElement,"cursor",e)},e.prototype.unsubscribeEventListeners=function(){var t=this;Object.keys(this.eventListenerSubscriptions).forEach(function(e){t.eventListenerSubscriptions[e](),delete t.eventListenerSubscriptions[e]})},e.prototype.setElementStyles=function(t,n){var r=this;Object.keys(n).forEach(function(e){r.renderer.setStyle(t,e,n[e])})},e.prototype.getScrollPosition=function(){return this.scrollContainer?{top:this.scrollContainer.elementRef.nativeElement.scrollTop,left:this.scrollContainer.elementRef.nativeElement.scrollLeft}:{top:window.pageYOffset||document.documentElement.scrollTop,left:window.pageXOffset||document.documentElement.scrollLeft}},e.decorators=[{type:a.Directive,args:[{selector:"[mwlDraggable]"}]}],e.ctorParameters=function(){return[{type:a.ElementRef},{type:a.Renderer2},{type:n},{type:a.NgZone},{type:a.ViewContainerRef},{type:r,decorators:[{type:a.Optional}]},{type:undefined,decorators:[{type:a.Inject,args:[t.DOCUMENT]}]}]},e.propDecorators={dropData:[{type:a.Input}],dragAxis:[{type:a.Input}],dragSnapGrid:[{type:a.Input}],ghostDragEnabled:[{type:a.Input}],showOriginalElementWhileDragging:[{type:a.Input}],validateDrag:[{type:a.Input}],dragCursor:[{type:a.Input}],dragActiveClass:[{type:a.Input}],ghostElementAppendTo:[{type:a.Input}],ghostElementTemplate:[{type:a.Input}],dragPointerDown:[{type:a.Output}],dragStart:[{type:a.Output}],ghostElementCreated:[{type:a.Output}],dragging:[{type:a.Output}],dragEnd:[{type:a.Output}]},e}();function c(e,t,n){return e>=n.left&&e<=n.right&&t>=n.top&&t<=n.bottom}var o=function(){function e(e,t,n,r,i){this.element=e,this.draggableHelper=t,this.zone=n,this.renderer=r,this.scrollContainer=i,this.dragEnter=new a.EventEmitter,this.dragLeave=new a.EventEmitter,this.dragOver=new a.EventEmitter,this.drop=new a.EventEmitter}return e.prototype.ngOnInit=function(){var a=this;this.currentDragSubscription=this.draggableHelper.currentDrag.subscribe(function(e){a.renderer.addClass(a.element.nativeElement,a.dragActiveClass);var o,t,s={updateCache:!0},n=a.renderer.listen(a.scrollContainer?a.scrollContainer.elementRef.nativeElement:"window","scroll",function(){s.updateCache=!0}),r=e.pipe(d.map(function(e){var t=e.clientX,n=e.clientY,r=e.dropData;o=r,s.updateCache&&(s.rect=a.element.nativeElement.getBoundingClientRect(),a.scrollContainer&&(s.scrollContainerRect=a.scrollContainer.elementRef.nativeElement.getBoundingClientRect()),s.updateCache=!1);var i=c(t,n,s.rect);return s.scrollContainerRect?i&&c(t,n,s.scrollContainerRect):i})),i=r.pipe(d.distinctUntilChanged());i.pipe(d.filter(function(e){return e})).subscribe(function(){t=!0,a.renderer.addClass(a.element.nativeElement,a.dragOverClass),a.zone.run(function(){a.dragEnter.next({dropData:o})})}),r.pipe(d.filter(function(e){return e})).subscribe(function(){a.zone.run(function(){a.dragOver.next({dropData:o})})}),i.pipe(d.pairwise(),d.filter(function(e){var t=g(e,2),n=t[0],r=t[1];return n&&!r})).subscribe(function(){t=!1,a.renderer.removeClass(a.element.nativeElement,a.dragOverClass),a.zone.run(function(){a.dragLeave.next({dropData:o})})}),e.subscribe({complete:function(){n(),a.renderer.removeClass(a.element.nativeElement,a.dragActiveClass),t&&(a.renderer.removeClass(a.element.nativeElement,a.dragOverClass),a.zone.run(function(){a.drop.next({dropData:o})}))}})})},e.prototype.ngOnDestroy=function(){this.currentDragSubscription&&this.currentDragSubscription.unsubscribe()},e.decorators=[{type:a.Directive,args:[{selector:"[mwlDroppable]"}]}],e.ctorParameters=function(){return[{type:a.ElementRef},{type:n},{type:a.NgZone},{type:a.Renderer2},{type:r,decorators:[{type:a.Optional}]}]},e.propDecorators={dragOverClass:[{type:a.Input}],dragActiveClass:[{type:a.Input}],dragEnter:[{type:a.Output}],dragLeave:[{type:a.Output}],dragOver:[{type:a.Output}],drop:[{type:a.Output}]},e}(),s=function(){function e(){}return e.decorators=[{type:a.NgModule,args:[{declarations:[i,o,r],exports:[i,o,r]}]}],e}();e.DragAndDropModule=s,e.ɵc=n,e.ɵd=r,e.ɵb=i,e.ɵa=o,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=angular-draggable-droppable.umd.min.js.map